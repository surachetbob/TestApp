import streamlit as st
from streamlit_gsheets import GSheetsConnection
import pandas as pd
from datetime import datetime

# --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
st.set_page_config(page_title="Health Insurance Calculator", layout="centered")

# ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets
conn = st.connection("gsheets", type=GSheetsConnection)

# CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI
st.markdown("""
    <style>
    div.stButton > button:first-child {
        width: 100%; height: 55px; font-size: 1.2rem; border-radius: 12px;
        background-color: #e91e63; color: white; border: none;
    }
    .stMetric { background-color: #fff0f5; padding: 15px; border-radius: 10px; }
    .detail-card {
        padding: 20px; border-radius: 10px; background-color: #f8f9fa;
        border-left: 5px solid #e91e63; margin-bottom: 10px;
    }
    .success-box {
        padding: 20px; background-color: #d4edda; color: #155724;
        border-radius: 10px; border: 1px solid #c3e6cb; margin-top: 10px;
    }
    </style>
    """, unsafe_allow_html=True)

# --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (PREMIUM_DATA) ---
PREMIUM_DATA = {
    "‡∏ä‡∏≤‡∏¢": {
        "‡πÅ‡∏ú‡∏ô 1 (1 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 16400), (16, 20, 13500), (21, 25, 13700), (26, 30, 14700), (31, 35, 15100), (36, 40, 17000), (41, 45, 19200), (46, 50, 21600), (51, 55, 28300), (56, 59, 34100), (60, 65, 40900), (66, 70, 59400), (71, 75, 85400), (76, 80, 122900), (81, 85, 177800), (86, 90, 204500), (91, 95, 235200), (96, 98, 270500)],
        "‡πÅ‡∏ú‡∏ô 2 (5 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 20200), (16, 20, 16500), (21, 25, 16900), (26, 30, 18300), (31, 35, 18900), (36, 40, 20800), (41, 45, 23800), (46, 50, 26700), (51, 55, 35000), (56, 59, 42300), (60, 65, 50600), (66, 70, 72100), (71, 75, 104000), (76, 80, 150000), (81, 85, 217100), (86, 90, 249700), (91, 95, 287200), (96, 98, 330300)],
        "‡πÅ‡∏ú‡∏ô 3 (15 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 25500), (16, 20, 20100), (21, 25, 21600), (26, 30, 26100), (31, 35, 29400), (36, 40, 31800), (41, 45, 36000), (46, 50, 40200), (51, 55, 50100), (56, 59, 63900), (60, 65, 72300), (66, 70, 105000), (71, 75, 152100), (76, 80, 219900), (81, 85, 318300), (86, 90, 366000), (91, 95, 420900), (96, 98, 484200)],
        "‡πÅ‡∏ú‡∏ô 4 (25 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 33400), (16, 20, 26200), (21, 25, 28000), (26, 30, 33800), (31, 35, 37800), (36, 40, 40900), (41, 45, 47300), (46, 50, 52400), (51, 55, 65300), (56, 59, 83000), (60, 65, 94100), (66, 70, 136700), (71, 75, 197800), (76, 80, 286300), (81, 85, 414700), (86, 90, 476900), (91, 95, 548400), (96, 98, 630700)]
    },
    "‡∏´‡∏ç‡∏¥‡∏á": {
        "‡πÅ‡∏ú‡∏ô 1 (1 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 14400), (16, 20, 15200), (21, 25, 17200), (26, 30, 17500), (31, 35, 18400), (36, 40, 20400), (41, 45, 22300), (46, 50, 24500), (51, 55, 28500), (56, 59, 34400), (60, 65, 41500), (66, 70, 60800), (71, 75, 88200), (76, 80, 126300), (81, 85, 182700), (86, 90, 210100), (91, 95, 241600), (96, 98, 277800)],
        "‡πÅ‡∏ú‡∏ô 2 (5 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 18200), (16, 20, 19100), (21, 25, 21500), (26, 30, 21800), (31, 35, 22700), (36, 40, 25100), (41, 45, 27800), (46, 50, 30400), (51, 55, 35200), (56, 59, 42500), (60, 65, 50800), (66, 70, 74000), (71, 75, 107500), (76, 80, 154400), (81, 85, 223400), (86, 90, 256900), (91, 95, 295400), (96, 98, 339700)],
        "‡πÅ‡∏ú‡∏ô 3 (15 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 21600), (16, 20, 23100), (21, 25, 27000), (26, 30, 30600), (31, 35, 34200), (36, 40, 37200), (41, 45, 42900), (46, 50, 46500), (51, 55, 50700), (56, 59, 65100), (60, 65, 73500), (66, 70, 107100), (71, 75, 155700), (76, 80, 224700), (81, 85, 325500), (86, 90, 374400), (91, 95, 430500), (96, 98, 495000)],
        "‡πÅ‡∏ú‡∏ô 4 (25 ‡∏•‡πâ‡∏≤‡∏ô)": [(11, 15, 27900), (16, 20, 30300), (21, 25, 35300), (26, 30, 38000), (31, 35, 42300), (36, 40, 46000), (41, 45, 53600), (46, 50, 60700), (51, 55, 65500), (56, 59, 84600), (60, 65, 95700), (66, 70, 139300), (71, 75, 202000), (76, 80, 291800), (81, 85, 422700), (86, 90, 486100), (91, 95, 559000), (96, 98, 642900)]
    }
}

PLAN_DETAILS = {
    "‡πÅ‡∏ú‡∏ô 1 (1 ‡∏•‡πâ‡∏≤‡∏ô)": {"room": "1,500", "doctor": "1,000", "medicine_return": "20,000", "opd": "‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á", "limit": "1,000,000"},
    "‡πÅ‡∏ú‡∏ô 2 (5 ‡∏•‡πâ‡∏≤‡∏ô)": {"room": "3,000", "doctor": "2,000", "medicine_return": "20,000", "opd": "‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á", "limit": "5,000,000"},
    "‡πÅ‡∏ú‡∏ô 3 (15 ‡∏•‡πâ‡∏≤‡∏ô)": {"room": "6,000", "doctor": "4,000", "medicine_return": "20,000", "opd": "‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á", "limit": "15,000,000"},
    "‡πÅ‡∏ú‡∏ô 4 (25 ‡∏•‡πâ‡∏≤‡∏ô)": {"room": "9,000", "doctor": "6,000", "medicine_return": "‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á", "opd": "2,000 ‡∏ö‡∏≤‡∏ó (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏õ‡∏µ)", "limit": "25,000,000"}
}

def calculate_premium(gender, plan, age):
    gender_data = PREMIUM_DATA.get(gender, {})
    plan_data = gender_data.get(plan, [])
    for start_age, end_age, price in plan_data:
        if start_age <= age <= end_age:
            return price
    return None

# --- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å ---
st.title("üõ°Ô∏è‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á")
st.write("‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•")

# 1. ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
with st.expander("üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô", expanded=True):
    col1, col2 = st.columns(2)
    with col1:
        gender_input = st.selectbox(" ‡πÄ‡∏û‡∏®", ["‡∏ä‡∏≤‡∏¢", "‡∏´‡∏ç‡∏¥‡∏á"])
    with col2:
        age_input = st.number_input(" ‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)", min_value=11, max_value=98, value=30)
    
    plan_input = st.selectbox("üìÇ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢", list(PLAN_DETAILS.keys()))
    
    calculate_btn = st.button("üöÄ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á")

if calculate_btn or 'show_results' in st.session_state:
    st.session_state.show_results = True
    premium = calculate_premium(gender_input, plan_input, age_input)
    
    if premium:
        st.divider()
        # ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
        st.metric(label=f"‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ ({gender_input})", value=f"{premium:,} ‡∏ö‡∏≤‡∏ó")
        st.info(f"‡∏≠‡∏≤‡∏¢‡∏∏ {age_input} ‡∏õ‡∏µ | ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á: {plan_input}")
            
        # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        details = PLAN_DETAILS[plan_input]
            
        st.subheader("üõ°Ô∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å")
            
        # ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á (‡πÉ‡∏ä‡πâ Columns ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°)
        c1, c2 = st.columns(2)
        with c1:
            st.markdown(f"""
            <div class="detail-card">
                <b>üè• ‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</b><br>
                {details['room']} ‡∏ö‡∏≤‡∏ó / ‡∏ß‡∏±‡∏ô
            </div>
            <div class="detail-card">
                <b>ü©∫ ‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏°</b><br>
                {details['doctor']} ‡∏ö‡∏≤‡∏ó / ‡∏ß‡∏±‡∏ô
            </div>
            """, unsafe_allow_html=True)
            
        with c2:
            st.markdown(f"""
            <div class="detail-card">
                <b>üíä ‡∏Ñ‡πà‡∏≤‡∏¢‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô (7 ‡∏ß‡∏±‡∏ô)</b><br>
                {details['medicine_return']}
            </div>
            <div class="detail-card">
                <b>üöë ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏µ</b><br>
                {details['limit']} ‡∏ö‡∏≤‡∏ó
            </div>
            """, unsafe_allow_html=True)
            
        # ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á (Common features)
        st.write("‚úÖ **‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á (‡∏ï‡∏≤‡∏°‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡∏ô):**")
        st.caption("* ‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á ICU (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 365 ‡∏ß‡∏±‡∏ô), ‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô ‡∏£‡∏û., ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î, ‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô (Day Surgery)")
            
        # ‡∏Å‡∏£‡∏ì‡∏µ OPD (‡∏´‡∏°‡∏ß‡∏î 3 ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2)
        if plan_input == "‡πÅ‡∏ú‡∏ô 4 (25 ‡∏•‡πâ‡∏≤‡∏ô)":
            st.warning(f"üí° **‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©:** ‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å (OPD): {details['opd']}")
        else:
            st.write(f"‚ö†Ô∏è **OPD:** ‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ")
    
        # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2
        with st.expander("‡∏î‡∏π‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"):
            st.write("""
            * **‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (24 ‡∏ä‡∏°.):** ‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
            * **‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ï/‡πÄ‡∏Ñ‡∏°‡∏µ‡∏ö‡∏≥‡∏ö‡∏±‡∏î/‡∏£‡∏±‡∏á‡∏™‡∏µ‡∏£‡∏±‡∏Å‡∏©‡∏≤:** ‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
            * **‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï:** 10,000 ‡∏ö‡∏≤‡∏ó
            * **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á:** ‡∏´‡∏≤‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô 2 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 3 ‡∏õ‡∏µ‡∏Å‡∏£‡∏°‡∏ò‡∏£‡∏£‡∏°‡πå
            """)

        # --- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ ---
        st.write("")
        if st.button("üéØ ‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô ‡∏°‡∏µ‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö"):
            st.session_state.show_lead_form = True

        # --- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ô‡πÉ‡∏à) ---
        if st.session_state.get('show_lead_form', False):
            with st.form("interest_form"):
                st.write("### üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠")
                name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
                phone = st.text_input("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", placeholder="‡πÄ‡∏ä‡πà‡∏ô 0865348448", max_chars=10)
                submit_lead = st.form_submit_button("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")

                if submit_lead:
                    if not name or len(phone) < 10 or not phone.isdigit():
                        st.error("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (10 ‡∏´‡∏•‡∏±‡∏Å)")
                    else:
                        try:
                            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet
                            new_data = pd.DataFrame([{
                                "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                                "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•": name,
                                "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£": phone,
                                "‡πÄ‡∏û‡∏®": gender_input,
                                "‡∏≠‡∏≤‡∏¢‡∏∏": age_input,
                                "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å": plan_input,
                                "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô": premium
                            }])
                            existing_data = conn.read(worksheet="Sheet1", ttl=0)
                            updated_df = pd.concat([existing_data, new_data], ignore_index=True)
                            conn.update(worksheet="Sheet1", data=updated_df)
                            
                            st.markdown(f'<div class="success-box">‚úÖ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì {name} ‡∏°‡∏µ‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå {phone} ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>', unsafe_allow_html=True)
                            st.balloons()
                            # Reset ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°
                            st.session_state.show_lead_form = False
                        except Exception as e:
                            st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {e}")

    else:
        st.error("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡∏µ‡πâ")

st.markdown("---")
st.info("üìû **‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:** ‡∏°‡∏µ‡∏ô ‡πÇ‡∏ó‡∏£ 086-5348448")
